# Простое сравнение массивов

Алгоритм для сравнения двух массивов данных с выявлением новых, удаленных и измененных записей. Каждая запись идентифицируется уникальным ID и может содержать несколько полей с данными.

## Типы данных

```typescript
// Базовые типы значений в коллекции
type CollectionType = string | Date | number | boolean;

// Структура значения элемента коллекции
interface CollectionItemValue {
  __val: unknown;     // Само значение
  __row: number;      // Номер строки
  __col: number;      // Номер колонки
}

// Структура элемента коллекции
interface CollectionItem {
  [key: string]: CollectionItemValue;
}

// Тип коллекции - массив элементов
type Collection = CollectionItem[];
```

## Принцип работы

1. Входные данные представляют собой два массива: новый (`newValues`) и старый (`oldValues`).
2. Первая строка каждого массива содержит заголовки колонок.
3. Каждая последующая строка содержит данные записи.
4. Алгоритм:
   - Преобразует массивы в коллекции объектов с метаданными
   - Создает карты (Map) для быстрого доступа по ID
   - Находит новые записи (есть в новом массиве, нет в старом)
   - Находит удаленные записи (есть в старом массиве, нет в новом)
   - Находит измененные записи (есть в обоих массивах, но значения отличаются)

## Пример входных данных

```typescript
const newValues = [
  ['id', 'param', 'status', 'mark'],
  ['Заказ 4', 1, 'done', 'mark'],
  ['Заказ 2', 1, 'in proc', 'mark'],
  ['Заказ 3', 1, 'in proc', 'mark'],
];

const oldValues = [
  ['id', 'param', 'status', 'mark'],
  ['Заказ 1', 1, 'done', 'mark'],
  ['Заказ 2', 2, 'done', 'mark'],
  ['Заказ 3', 1, 'done', 'mark'],
];
```

## Результат сравнения

Алгоритм возвращает три массива:

1. `newItems` - новые записи (присутствуют только в новом массиве)
2. `oldItems` - удаленные записи (присутствуют только в старом массиве)
3. `changedItems` - измененные записи, содержащие:
   - `id` - идентификатор записи
   - `new` - новые значения
   - `old` - старые значения
   - `__modified` - объект с информацией об изменениях:
     - `__status` - флаг наличия изменений
     - для каждого измененного поля: `{ new: новое_значение, old: старое_значение }`

## Особенности

- Каждое значение в коллекции содержит метаданные о своем расположении (строка и колонка)
- Сравнение происходит по значениям (`__val`), игнорируя метаданные
- Поле `id` используется как ключ для сопоставления записей и не участвует в сравнении изменений
- Алгоритм учитывает только существующие поля, игнорируя отсутствующие

## Пример использования

```typescript
// Создание коллекций из массивов
const newData = convertToCollection(newValues);
const oldData = convertToCollection(oldValues);

// Получение результатов сравнения
const { newItems, oldItems, changedItems } = compareCollections(newData, oldData);

console.log('Новые записи:', newItems);
console.log('Удаленные записи:', oldItems);
console.log('Измененные записи:', changedItems);
